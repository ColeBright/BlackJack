@model BlackJack.Domain.GameModels.GameEngine

@{
    var imgPath = "/images/cards/back.png";
}
<div class="game-container">
    <h2>BlackJack</h2>

    <div>
        <p>Balance: @Model.PlayerBet.PlayerBalance</p>
        <p>Current Bet: @Model.PlayerBet.CurrentBet</p>
    </div>

    @if (TempData["Error"] != null)
    {
        <div class="text-danger">@TempData["Error"]</div>
    }

    @{
        var hasCards = Model.PlayerHand.Cards.Any() || Model.DealerHand.Cards.Any();
    }

    @* Before a round starts: allow betting and only show New Round *@
    @if (!hasCards)
    {
        @Html.Partial("_BetPartial", Model)

        <form method="post" asp-action="Start">
            <button type="submit" class="btn btn-warning">New Round</button>
        </form>
    }
    else
    {
        <h4>Dealer</h4>
        <ul>
            @for (int i = 0; i < Model.DealerHand.Cards.Count; i++)
            {
                if (i == 1 && !Model.IsRoundFinished())
                {
                    <img src="@imgPath" alt="Back of card" style="width: 110px; height:auto;" />
                }
                else
                {
                    @Html.Partial("_CardPartial", Model.DealerHand.Cards[i])
                }
            }
        </ul>

        <h4>Player</h4>
        <ul>
            @foreach (var card in Model.PlayerHand.Cards)
            {
                @Html.Partial("_CardPartial", card)
            }
        </ul>

        @if (!Model.IsRoundFinished())
        {
            <div class="button-container">
                <form method="post" asp-action="Hit">
                    <button type="submit" class="btn btn-primary">Hit</button>
                </form>
                <form method="post" asp-action="Stand">
                    <button type="submit" class="btn btn-primary">Stand</button>
                </form>
            </div>
        }

        <form method="post" asp-action="Start">
            <button type="submit" class="btn btn-warning">New Round</button>
        </form>

        @if (Model.IsRoundFinished())
        {
            @Html.Partial("_ResultPartial", Model)
        }
    }
</div>
